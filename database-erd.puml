@startuml ERD Sistem Pengajuan HKI

!define table(name,desc) class name as "desc" << (T,#FFAAAA) >>
!define primary_key(x) <b><color:red>x</color></b>
!define foreign_key(x) <color:blue>x</color>
!define unique(x) <color:green>x</color>

' Tabel 1: Users
table(users, "users\n(Data Pengguna)") {
  primary_key(id) : bigint
  unique(username) : varchar(255)
  nama_lengkap : varchar(255)
  unique(email) : varchar(255)
  password : varchar(255)
  role : enum('mahasiswa','dosen','direktur','admin')
  nip_nim : varchar(50)
  no_hp : varchar(20)
  ttd_path : varchar(255)
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 2: Mahasiswa
table(mahasiswas, "mahasiswas\n(Data Mahasiswa)") {
  primary_key(id) : bigint
  foreign_key(user_id) : bigint
  nim : varchar(20)
  nama : varchar(255)
  program_studi : varchar(255)
  fakultas : varchar(255)
  semester : int
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 3: Dosen
table(dosens, "dosens\n(Data Dosen)") {
  primary_key(id) : bigint
  foreign_key(user_id) : bigint
  nip : varchar(20)
  nama : varchar(255)
  fakultas : varchar(255)
  jabatan : varchar(100)
  bidang_keahlian : varchar(255)
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 4: Pengajuan HKI
table(pengajuan_hkis, "pengajuan_hkis\n(Data Pengajuan HKI)") {
  primary_key(id) : bigint
  foreign_key(user_id) : bigint
  nomor_pengajuan : varchar(255)
  judul_ciptaan : varchar(255)
  deskripsi_ciptaan : text
  jenis_ciptaan : varchar(255)
  tanggal_ciptaan : date
  jumlah_pencipta : int
  nama_pencipta : json
  nama_pengusul : varchar(255)
  file_karya : varchar(255)
  file_dokumen_pendukung : json
  status : enum('draft','menunggu_validasi','divalidasi_sedang_diproses','menunggu_pembayaran','menunggu_verifikasi_pembayaran','disetujui','selesai','ditolak')
  catatan : text
  tahun_usulan : year
  billing_code : varchar(255)
  bukti_pembayaran : varchar(255)
  sertifikat : varchar(255)
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 5: Dokumen HKI
table(dokumen_hkis, "dokumen_hkis\n(Dokumen Pengajuan)") {
  primary_key(id) : bigint
  foreign_key(pengajuan_hki_id) : bigint
  jenis_dokumen : varchar(255)
  nama_file : varchar(255)
  path_file : varchar(255)
  ukuran_file : bigint
  is_uploaded : boolean
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 6: Validasi P3M
table(validasi_p3ms, "validasi_p3ms\n(Proses Validasi)") {
  primary_key(id) : bigint
  foreign_key(pengajuan_hki_id) : bigint
  foreign_key(validator_id) : bigint
  tanggal_validasi : datetime
  status_validasi : enum('pending','approved','rejected')
  catatan_validasi : text
  dokumen_ttd : varchar(255)
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 7: Persetujuan Direktur
table(persetujuan_direkturs, "persetujuan_direkturs\n(Proses Persetujuan)") {
  primary_key(id) : bigint
  foreign_key(pengajuan_hki_id) : bigint
  foreign_key(direktur_id) : bigint
  tanggal_persetujuan : datetime
  status_persetujuan : enum('pending','approved','rejected')
  catatan_persetujuan : text
  dokumen_ttd : varchar(255)
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 8: Pembayaran
table(pembayarans, "pembayarans\n(Data Pembayaran)") {
  primary_key(id) : bigint
  foreign_key(pengajuan_hki_id) : bigint
  billing_code : varchar(255)
  nominal : decimal(15,2)
  metode_pembayaran : enum('transfer','tunai','e_wallet')
  tanggal_bayar : datetime
  bukti_pembayaran : varchar(255)
  status_pembayaran : enum('pending','success','failed')
  foreign_key(verifikator_id) : bigint
  tanggal_verifikasi : datetime
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 9: Sertifikat
table(sertifikats, "sertifikats\n(Sertifikat HKI)") {
  primary_key(id) : bigint
  foreign_key(pengajuan_hki_id) : bigint
  nomor_sertifikat : varchar(255)
  tanggal_terbit : date
  tanggal_berlaku : date
  tanggal_berakhir : date
  file_sertifikat : varchar(255)
  qr_code : varchar(255)
  foreign_key(penerbit_id) : bigint
  created_at : timestamp
  updated_at : timestamp
}

' Tabel 10: Riwayat Status
table(riwayat_statuses, "riwayat_statuses\n(Audit Trail)") {
  primary_key(id) : bigint
  foreign_key(pengajuan_hki_id) : bigint
  foreign_key(user_id) : bigint
  status_lama : varchar(255)
  status_baru : varchar(255)
  catatan : text
  tanggal_perubahan : timestamp
  created_at : timestamp
  updated_at : timestamp
}

' Relasi antar tabel
users ||--o{ mahasiswas : "1..1"
users ||--o{ dosens : "1..1" 
users ||--o{ pengajuan_hkis : "1..*"
users ||--o{ validasi_p3ms : "validator"
users ||--o{ persetujuan_direkturs : "direktur"
users ||--o{ riwayat_statuses : "1..*"
users ||--o{ pembayarans : "verifikator"
users ||--o{ sertifikats : "penerbit"

pengajuan_hkis ||--o{ dokumen_hkis : "1..*"
pengajuan_hkis ||--o{ validasi_p3ms : "1..1"
pengajuan_hkis ||--o{ persetujuan_direkturs : "1..1"
pengajuan_hkis ||--o{ riwayat_statuses : "1..*"
pengajuan_hkis ||--o{ pembayarans : "1..1"
pengajuan_hkis ||--o{ sertifikats : "1..1"

@enduml